#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit hook..."

# 只針對 staged 檔案做 ESLint + auto fix
pnpm exec lint-staged

# 檢查 staged 檔案是否有 CR(\r) 字元，避免 CRLF
files="$(git diff --cached --name-only --diff-filter=ACM)"

if [ -n "$files" ]; then
  # 如果 grep 有找到 CR，就會進到 then
  if echo "$files" | xargs grep -m 1 -I $'\r' >/dev/null 2>&1; then
    echo "❌ CR 字元檢查失敗！請將檔案行尾改成 LF 再提交。"
    exit 1
  fi
fi

echo "✅ pre-commit done"
